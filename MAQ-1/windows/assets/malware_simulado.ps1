# Simulação de artefato de malware para laboratório
# Cria arquivo, chave de registro e serviço falso

# 1. Cria arquivo suspeito
Set-Content -Path "C:\malware.txt" -Value "Este é um artefato simulado para análise de IoC."

# 2. Adiciona chave de registro
New-Item -Path "HKLM:\SOFTWARE\MalwareLab" -Force | Out-Null
Set-ItemProperty -Path "HKLM:\SOFTWARE\MalwareLab" -Name "MaliciousValue" -Value "SimulatedMalware"

# 3. Cria serviço falso (não executa nada, apenas para análise)
New-Service -Name "MalwareService" -BinaryPathName "C:\Windows\System32\svchost.exe" -DisplayName "Malware Simulado" -Description "Serviço criado para simulação de IoC" -StartupType Automatic

# 4. (Opcional) Baixa arquivo EICAR de teste
# Invoke-WebRequest -Uri "https://www.eicar.org/download/eicar.com" -OutFile "C:\eicar.com"

# 5. Loga evento no Event Viewer
Write-EventLog -LogName Application -Source "Windows PowerShell" -EventId 9999 -EntryType Information -Message "Malware simulado executado para laboratório."

# 6. Cria tarefa agendada para execução automática a cada boot
$taskName = "MalwareSimuladoStartup"
$scriptPath = "C:\malware_simulado.ps1"
$action = New-ScheduledTaskAction -Execute "powershell.exe" -Argument "-ExecutionPolicy Bypass -File $scriptPath"
$trigger = New-ScheduledTaskTrigger -AtStartup
Register-ScheduledTask -TaskName $taskName -Action $action -Trigger $trigger -RunLevel Highest -Force
